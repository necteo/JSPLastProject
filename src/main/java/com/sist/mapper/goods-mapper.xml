<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.goods-mapper">
  <!-- 상품 목록 (전체 목록) 
  NO                                                                                                                      NUMBER(38)
 GOODS_NAME                                                                                                              VARCHAR2(4000)
 GOODS_SUB                                                                                                               VARCHAR2(4000)
 GOODS_PRICE                                                                                                             VARCHAR2(26)
 GOODS_DISCOUNT                                                                                                          NUMBER(38)
 GOODS_FIRST_PRICE                                                                                                       VARCHAR2(4000)
 GOODS_DELIVERY                                                                                                          VARCHAR2(4000)
 GOODS_POSTER                                                                                                            VARCHAR2(4000)
 HIT                
  -->
  <select id="goodsListData" resultType="GoodsVO" parameterType="hashmap">
    SELECT no, goods_name, goods_sub, goods_price, goods_discount, goods_poster, hit, num
    FROM (SELECT no, goods_name, goods_sub, goods_price, goods_discount, goods_poster, hit, rownum num
    	  FROM (SELECT no, goods_name, goods_sub, goods_price, goods_discount, goods_poster, hit
    	  		FROM ${goods} ORDER BY no))
    WHERE num BETWEEN #{start} AND #{end}
  </select>
  
  <select id="goodsTotalPage" resultType="int" parameterType="hashmap">
     SELECT CEIL(COUNT(*) / 12)
     FROM ${goods}
  </select>
  
  <update id="goodsHitIncrement" parameterType="hashmap">
  	UPDATE ${goods} 
  	SET hit = hit + 1
  	WHERE no = #{no}
  </update>
  
  <select id="goodsDetailData" resultType="GoodsVO" parameterType="hashmap">
  	SELECT * FROM ${goods}
  	WHERE no = #{no}
  </select>
  
  <insert id="orderInsert" parameterType="com.sist.vo.OrdersVO">
    INSERT INTO orders VALUES(orders_no_seq.nextval, #{gno}, #{id}, #{name}, #{post}, #{addr1}, #{addr2}, #{msg}, #{account}, SYSDATE)
  </insert>
  
  <resultMap type="com.sist.vo.OrdersVO" id="orderMap">
    <result column="goods_poster" property="gvo.goods_poster"/>
    <result column="goods_name" property="gvo.goods_name"/>
    <result column="goods_price" property="gvo.goods_price"/>
  </resultMap>
  <select id="orderListData" parameterType="string" resultMap="orderMap">
    SELECT o.no, o.gno, goods_poster, goods_name, goods_price, account, TO_CHAR(regdate, 'YYYY-MM-DD') dbday
    FROM orders o, goods_all g
    WHERE o.gno = g.no
    AND id = #{id}
  </select>
  
  <select id="orderDetailData" parameterType="int" resultMap="orderMap">
    SELECT o.no, o.gno, goods_poster, goods_name, goods_price, account, TO_CHAR(regdate, 'YYYY-MM-DD') dbday,
    	   name, post, addr1, addr2, msg
    FROM orders o, goods_all g
    WHERE o.gno = g.no
    AND o.no = #{no}
  </select>
</mapper>